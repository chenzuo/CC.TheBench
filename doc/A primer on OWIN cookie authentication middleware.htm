<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0109)http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>A primer on OWIN cookie authentication middleware for the ASP.NET developer | brockallen</title>
<!--[if lt IE 8]><link rel="stylesheet" type="text/css" media="screen" href="http://s1.wp.com/wp-content/themes/pub/vigilance/stylesheets/ie.css?m=1280263635g" /><![endif]-->
<!--[if lte IE 6]><link rel="stylesheet" type="text/css" media="screen" href="http://s1.wp.com/wp-content/themes/pub/vigilance/stylesheets/ie6.css?m=1275938991g" /><![endif]-->
<link rel="pingback" href="http://brockallen.com/xmlrpc.php">
		<script src="./A primer on OWIN cookie authentication middleware_files/quant.js" async="" type="text/javascript"></script><script src="./A primer on OWIN cookie authentication middleware_files/remote-login.php" type="text/javascript"></script><style type="text/css"></style>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel="alternate" type="application/rss+xml" title="brockallen » Feed" href="http://brockallen.com/feed/">
<link rel="alternate" type="application/rss+xml" title="brockallen » Comments Feed" href="http://brockallen.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="brockallen » A primer on OWIN cookie authentication middleware for the ASP.NET developer Comments Feed" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/feed/">
<script type="text/javascript">
/* <![CDATA[ */
function addLoadEvent(func){var oldonload=window.onload;if(typeof window.onload!='function'){window.onload=func;}else{window.onload=function(){oldonload();func();}}}
/* ]]> */
</script>
<style type="text/css">
	/*body div.jp-relatedposts { border-color:#eeeeee; }
	body div.jp-relatedposts .jp-relatedposts-headline em { background:#ffffff }
	body div.jp-relatedposts, body div.jp-relatedposts .jp-relatedposts-post a { color:#333333 }*/
	body div.jp-relatedposts .jp-relatedposts-headline em:before { border-color:#333333; }
</style><link rel="stylesheet" id="all-css-0" href="./A primer on OWIN cookie authentication middleware_files/saved_resource" type="text/css" media="all">
<link rel="stylesheet" id="print-css-0" href="./A primer on OWIN cookie authentication middleware_files/global-print.css" type="text/css" media="print">
<script type="text/javascript" src="./A primer on OWIN cookie authentication middleware_files/saved_resource(1)"></script>
<link rel="stylesheet" id="all-css-0" href="./A primer on OWIN cookie authentication middleware_files/style.css" type="text/css" media="all">
<!--[if lt IE 8]>
<link rel='stylesheet' id='highlander-comments-ie7-css'  href='http://s2.wp.com/wp-content/mu-plugins/highlander-comments/style-ie7.css?m=1351637563g&#038;ver=20110606' type='text/css' media='all' />
<![endif]-->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://brockallen.wordpress.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://brockallen.wordpress.com/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="MembershipReboot in IdentityServer" href="http://brockallen.com/2013/10/23/membershipreboot-in-identityserver/">
<link rel="next" title="Host authentication and Web API with OWIN and active vs. passive authentication middleware" href="http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/">
<meta name="generator" content="WordPress.com">
<link rel="canonical" href="./A primer on OWIN cookie authentication middleware_files/A primer on OWIN cookie authentication middleware.htm">
<link rel="shortlink" href="http://wp.me/p1BjCh-jC">
<link rel="alternate" type="application/json+oembed" href="http://public-api.wordpress.com/oembed/1.0/?format=json&url=http%3A%2F%2Fbrockallen.com%2F2013%2F10%2F24%2Fa-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer%2F&for=wpcom-auto-discovery"><link rel="alternate" type="application/xml+oembed" href="http://public-api.wordpress.com/oembed/1.0/?format=xml&url=http%3A%2F%2Fbrockallen.com%2F2013%2F10%2F24%2Fa-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer%2F&for=wpcom-auto-discovery">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article">
<meta property="og:title" content="A primer on OWIN cookie authentication middleware for the ASP.NET developer">
<meta property="og:url" content="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/">
<meta property="og:description" content="There have been many changes to how authentication is performed for web applications in Visual Studio 2013. For one, there&#39;s a new &quot;Change Authentication&quot; wizard to configure the various ways an ap...">
<meta property="og:site_name" content="brockallen">
<meta property="og:image" content="http://brockallen.files.wordpress.com/2013/10/individual.jpg">
<meta name="twitter:site" content="@wordpressdotcom">
<meta name="twitter:image" content="http://brockallen.files.wordpress.com/2013/10/individual.jpg?w=240">
<meta name="twitter:card" content="summary">
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom">
<link rel="shortcut icon" type="image/x-icon" href="http://0.gravatar.com/blavatar/ee5feb5d2dbb58481e1b8d2103143105?s=16" sizes="16x16">
<link rel="icon" type="image/x-icon" href="http://0.gravatar.com/blavatar/ee5feb5d2dbb58481e1b8d2103143105?s=16" sizes="16x16">
<link rel="apple-touch-icon-precomposed" href="http://0.gravatar.com/blavatar/ca1698a818f41196724300c662864e07?s=114">
<link rel="openid.server" href="http://brockallen.wordpress.com/?openidserver=1">
<link rel="openid.delegate" href="http://brockallen.wordpress.com/">
<link rel="search" type="application/opensearchdescription+xml" href="http://brockallen.com/osd.xml" title="brockallen">
<link rel="search" type="application/opensearchdescription+xml" href="http://wordpress.com/opensearch.xml" title="WordPress.com">

	<meta name="application-name" content="brockallen"><meta name="msapplication-window" content="width=device-width;height=device-height"><meta name="msapplication-tooltip" content="You&#39;ve got your good thing, and you&#39;ve got mine"><meta name="msapplication-task" content="name=Subscribe;action-uri=http://brockallen.com/feed/;icon-uri=http://0.gravatar.com/blavatar/ee5feb5d2dbb58481e1b8d2103143105?s=16"><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=http://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=http://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=http://s2.wp.com/i/favicon.ico"><meta name="title" content="A primer on OWIN cookie authentication middleware for the ASP.NET developer | brockallen on WordPress.com">
<meta name="description" content="There have been many changes to how authentication is performed for web applications in Visual Studio 2013. For one, there&#39;s a new &quot;Change Authentication&quot; wizard to configure the various ways an application can authenticate users. The approach to authentication that&#39;s undergone the most changes in this version is local cookie-based authentication and external login providers…">
	<style type="text/css">
				#title a { color: #444444 }
		</style>
<link rel="stylesheet" type="text/css" href="./A primer on OWIN cookie authentication middleware_files/shCore.css"><link rel="stylesheet" type="text/css" href="./A primer on OWIN cookie authentication middleware_files/shThemeDefault.css"><style id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="./A primer on OWIN cookie authentication middleware_files/saved_resource(2)">
		<link rel="stylesheet" type="text/css" id="gravatar-card-css" href="./A primer on OWIN cookie authentication middleware_files/hovercard.css"><link rel="stylesheet" type="text/css" id="gravatar-card-services-css" href="./A primer on OWIN cookie authentication middleware_files/services.css"></head>
<body class="single single-post postid-1216 single-format-standard mp6 typekit-enabled vigilance-light highlander-enabled highlander-light" style="">
	<div class="skip-content"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#content">Skip to content</a></div>
	<div id="wrapper">
				<div id="header" class="clear">
			<div id="title"><a href="http://brockallen.com/"><span>brockallen</span></a></div>			<div id="description">
				<h2>You've got your good thing, and you've got mine</h2>
			</div><!--end description-->
			<div id="nav">
					<ul class="menu">
		<li class="page_item "><a href="http://brockallen.com/">Home</a></li>
				<li class="page_item page-item-2"><a href="http://brockallen.com/about/">About</a></li>
<li class="page_item page-item-1044"><a href="http://brockallen.com/projects/">Projects</a></li>
<li class="page_item page-item-243 page_item_has_children"><a href="http://brockallen.com/resources/">Resources</a></li>
	</ul>
			</div><!--end nav-->
		</div><!--end header-->
		<div id="content" class="pad">
									<div id="post-1216" class="post-1216 post type-post status-publish format-standard hentry category-asp-net-security category-owin-katana">
			<div class="post-header">
				<h1>A primer on OWIN cookie authentication middleware for the ASP.NET&nbsp;developer</h1>
				<div id="single-date" class="date">October 24, 2013</div>
			</div><!--end post header-->
			<div class="meta clear">
				<div class="tags"></div>
				<div class="author">
									</div>
			</div><!--end meta-->
			<div class="entry clear">
								<p>There have been many changes to how authentication is performed for web applications in Visual Studio 2013. For one, there’s a new “Change Authentication” wizard to configure the various ways an application can authenticate users. The approach to authentication that’s undergone the most changes in this version is local cookie-based authentication and external login providers based upon OAuth2 and OpenID (social logins). This style of logins is now collectively known as the “Individual User Accounts” and it’s one option in the new authentication wizard. This purpose of this post (and followup posts) is to explain the new authentication plumbing for this option.</p>
<p><a href="http://brockallen.files.wordpress.com/2013/10/individual.jpg"><img class="aligncenter size-full wp-image-1221" alt="Individual" src="./A primer on OWIN cookie authentication middleware_files/individual.jpg" width="600" height="266"></a></p>
<p><strong>OWIN authentication middleware</strong></p>
<p>With .NET 4.5.1, for ASP.NET applications, all the underlying code that handles “Individual User Accounts”&nbsp;(as well as the templates in Visual Studio 2013) is new. This means for cookie based authentication we no longer use Forms authentication and for external identity providers we no longer use DotNetOpenAuth.</p>
<p>The replacement is a framework called OWIN authentication middleware and it’s targeting the OWIN API. I don’t plan to motivate OWIN here (<a href="http://msdn.microsoft.com/en-us/magazine/dn451439.aspx">this</a> a good article on the subject), but in short it’s an abstraction API for the web host. Many frameworks such as Web API and SignalR (as well as other non-Microsoft frameworks) are coded to this abstraction so they do not require any particular web host (such as IIS).</p>
<p>So this OWIN authentication middleware is the new framework for authenticating users. The two main options we have is local authentication where the users enter credentials into the application itself, and external logins where the user is redirected to the various social login providers that are supported by Microsoft.</p>
<p>This post will only cover the cookie approach. Subsequent posts will describe the others.</p>
<p><strong>OWIN cookie authentication middleware</strong></p>
<p>Previously, for local authentication we used to use Forms authentication and its job was to issue a cookie to represent the current logged in user. Upon subsequent requests from the user, Forms authentication would validate the cookie and make a principal object available that represents the user’s identity.</p>
<p>Now, the new cookie-based implementation is called the OWIN cookie authentication middleware. This performs the same task — it can issue a cookie and then validates the cookie on subsequent requests. One improvement the OWIN cookie authentication middleware has over the previous Forms authentication is that it is claims-aware.</p>
<p>Another function of Forms authentication was that when the application issued a 401 unauthorized HTTP status code, Forms authentication would convert the response into a 302 redirect to the application’s login page. Well, the new cookie authentication middleware does that too.</p>
<p><strong>Configuration</strong></p>
<p>The new OWIN cookie authentication middleware is configured in App_Start/Startup.Auth.cs and consists of these lines of code:</p>
<div><div id="highlighter_411466" class="syntaxhighlighter  csharp"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp keyword">public</code> <code class="csharp keyword">void</code> <code class="csharp plain">ConfigureAuth(IAppBuilder app)</code></div><div class="line number2 index1 alt1"><code class="csharp plain">{</code></div><div class="line number3 index2 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">app.UseCookieAuthentication(</code><code class="csharp keyword">new</code> <code class="csharp plain">CookieAuthenticationOptions</code></div><div class="line number4 index3 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">AuthenticationType = DefaultAuthenticationTypes.ApplicationCookie,</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">LoginPath = </code><code class="csharp keyword">new</code> <code class="csharp plain">PathString(</code><code class="csharp string">"/Account/Login"</code><code class="csharp plain">)</code></div><div class="line number7 index6 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">});</code></div><div class="line number8 index7 alt1"><code class="csharp plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>This API call is configuring an identifier (or name) for this authentication middleware (AuthenticationType) and this is needed since there can be different authentication middleware. Also, this name influences the name of the cookie that will be used. The LoginPath is simply the URL to the login page when unauthorized requests need to be redirected.</p>
<p><strong>Redirect to login</strong></p>
<p>As mentioned above, the OWIN cookie middleware will redirect unauthorized requests to the login page. This is only performed if the LoginPath is set. If it’s not set, then this feature is disabled.</p>
<p><strong>Login</strong></p>
<p>On the login page once the user’s credentials have been validated, we can call into OWIN to authenticate the user. We don’t call the cookie middleware directly, instead we call into the “OWIN Authentication Manager”, which is an abstraction for all of the possible OWIN authentication middleware that’s being used. This call can be seen in the new templates and here’s the code if you wanted to invoke it yourself:</p>
<div><div id="highlighter_410834" class="syntaxhighlighter  csharp"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">var claims = </code><code class="csharp keyword">new</code> <code class="csharp plain">List&lt;Claim&gt;();</code></div><div class="line number2 index1 alt1"><code class="csharp plain">claims.Add(</code><code class="csharp keyword">new</code> <code class="csharp plain">Claim(ClaimTypes.Name, </code><code class="csharp string">"Brock"</code><code class="csharp plain">));</code></div><div class="line number3 index2 alt2"><code class="csharp plain">claims.Add(</code><code class="csharp keyword">new</code> <code class="csharp plain">Claim(ClaimTypes.Email, </code><code class="csharp string">"brockallen@gmail.com"</code><code class="csharp plain">));</code></div><div class="line number4 index3 alt1"><code class="csharp plain">var id = </code><code class="csharp keyword">new</code> <code class="csharp plain">ClaimsIdentity(claims,</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">DefaultAuthenticationTypes.ApplicationCookie);</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="csharp plain">var ctx = Request.GetOwinContext();</code></div><div class="line number8 index7 alt1"><code class="csharp plain">var authenticationManager = ctx.Authentication;</code></div><div class="line number9 index8 alt2"><code class="csharp plain">authenticationManager.SignIn(id);</code></div></div></td></tr></tbody></table></div></div>
<p>The above code creates the set of claims to represent the identity of the user and creates a ClaimsIdentity from the claims. Note the second parameter to the ClaimsIdentity constructor — this indicates the type of authentication. In the OWIN authentication middleware, this authentication type must match that of the middleware being targeted. So since this code is presumably trying to issue a cookie, then this value must be the same as the name we assigned to the cookie middleware from the ConfigureAuth initialization code from above.</p>
<p>Once the ClaimsIdentity is created, we then access the OwinContext which has the AuthenticationManager. We use its SignIn API passing the ClaimsIdentity. This then matches the authentication type to the corresponding authentication middleware and since we match the cookie authentication middleware, a cookie is issued that contains the claims of the ClaimsIdentity.</p>
<p>An additional option on the SignIn API is to pass a AuthenticationProperties object. This has an IsPersistent property that indicates if the cookie is to be persistent.</p>
<p><strong>Visual Studio 2013 templates and ASP.NET Identity</strong></p>
<p>The VS2013 templates use the new ASP.NET Identity system to obtain the claims for the user. In the templates you will see this being performed by the UserManager’s CreateIdentityAsync API. Additionally, the MVC and WebForms templates provide many helper methods that encapsulate accessing and calling into the authentication manager.</p>
<p><strong>Protecting the cookie</strong></p>
<p>As a side note, the contents of the cookie are protected as you’d expect (signed and encrypted). This protection is by default, which is good. There is yet another security setting, though, that requires attention: SSL. By default (presumably for simplicity and ease of development) the cookie is only issued with the secure flag (i.e. require SSL) is the incoming request is SSL. This is an important setting to change when you release your application to production. This setting is configured with an enum:</p>
<div><div id="highlighter_81693" class="syntaxhighlighter  csharp"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp keyword">public</code> <code class="csharp keyword">enum</code> <code class="csharp plain">CookieSecureOption</code></div><div class="line number2 index1 alt1"><code class="csharp plain">{</code></div><div class="line number3 index2 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">SameAsRequest,</code></div><div class="line number4 index3 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">Never,</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">Always</code></div><div class="line number6 index5 alt1"><code class="csharp plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>and would be done with this configuration change (notice the CookieSecure flag):</p>
<div><div id="highlighter_891912" class="syntaxhighlighter  csharp"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp keyword">public</code> <code class="csharp keyword">void</code> <code class="csharp plain">ConfigureAuth(IAppBuilder app)</code></div><div class="line number2 index1 alt1"><code class="csharp plain">{</code></div><div class="line number3 index2 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">app.UseCookieAuthentication(</code><code class="csharp keyword">new</code> <code class="csharp plain">CookieAuthenticationOptions</code></div><div class="line number4 index3 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">AuthenticationType = DefaultAuthenticationTypes.ApplicationCookie,</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">LoginPath = </code><code class="csharp keyword">new</code> <code class="csharp plain">PathString(</code><code class="csharp string">"/Account/Login"</code><code class="csharp plain">),</code></div><div class="line number7 index6 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">CookieSecure = CookieSecureOption.Always</code></div><div class="line number8 index7 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">});</code></div><div class="line number9 index8 alt2"><code class="csharp plain">}</code></div></div></td></tr></tbody></table></div></div>
<p><strong>Other cookie configuration</strong></p>
<p>There are two other settings of particular interest on the CookieAuthenticationOptions that might be familiar: ExpireTimeSpan and SlidingExpiration. The expiration allows the application to indicate how long the cookie is valid, and the sliding flag allows the expiration to be renewed as the user remains active within the application. The default for the expiration is 14 days and the default for the sliding flag is true.</p>
<p><strong>Cookie authentication</strong></p>
<p>So now that we have a cookie issued to the browser, upon subsequent requests the cookie will be sent and the cookie middleware must authenticate the request. The cookie middlware looks for the cookie name it issued (again from the name we assigned to the cookie middleware). If the cookie is absent, then it does nothing. If the cookie is present, then the cookie middleware reads and validates the cookie, and then if validated unpacks the claims contained therein and creates a ClaimsIdentity and sets this object into the OWIN context. Any downstream code could then use this OWIN API to determine the caller’s identity:</p>
<div><div id="highlighter_108729" class="syntaxhighlighter  csharp "><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">OwinContext ctx = Request.GetOwinContext();</code></div><div class="line number2 index1 alt1"><code class="csharp plain">ClaimsPrincipal user = ctx.Authentication.User;</code></div><div class="line number3 index2 alt2"><code class="csharp plain">IEnumerable&lt;Claim&gt; claims = user.Claims;</code></div></div></td></tr></tbody></table></div></div>
<p>Of course, the ASP.NET APIs also work (Page.User, Controller.User) as well as the IIS host approaches (HttpContext.User, Thread.CurrentPrincipal and ClaimsPrincipal.Current).</p>
<p><strong>Logout</strong></p>
<p>Logging a user out is quite simple — there’s an API on the OWIN authentication manager called SignOut, which removes the cookie:</p>
<div><div id="highlighter_450418" class="syntaxhighlighter  csharp "><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">var ctx = Request.GetOwinContext();</code></div><div class="line number2 index1 alt1"><code class="csharp plain">var authenticationManager = ctx.Authentication;</code></div><div class="line number3 index2 alt2"><code class="csharp plain">authenticationManager.SignOut();</code></div></div></td></tr></tbody></table></div></div>
<p><strong>Fin</strong></p>
<p>I hope this helps to understand the new OWIN cookie authentication middleware in .NET 4.5.1 and Visual Studio 2013.</p>
<div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow" class="share-twitter sd-button share-icon" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?share=twitter&nb=1" title="Click to share on Twitter" id="sharing-twitter-1216"><span>Twitter<span class="share-count">24</span></span></a></li><li class="share-facebook"><a rel="nofollow" class="share-facebook sd-button share-icon" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?share=facebook&nb=1" title="Share on Facebook" id="sharing-facebook-1216"><span>Facebook<span class="share-count">2</span></span></a></li><li class="share-google-plus-1"><a rel="nofollow" class="share-google-plus-1 sd-button share-icon" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?share=google-plus-1&nb=1" title="Click to share on Google+" id="sharing-google-1216"><span>Google</span></a></li><li class="share-end"></li></ul></div></div></div><div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-loaded" id="like-post-wrapper-23669881-1216-52d28636d5656" data-src="//widgets.wp.com/likes/#blog_id=23669881&amp;post_id=1216&amp;origin=brockallen.wordpress.com&amp;obj_id=23669881-1216-52d28636d5656" data-name="like-post-frame-23669881-1216-52d28636d5656"><h3 class="sd-title">Like this:</h3><div class="likes-widget-placeholder post-likes-widget-placeholder" style="height: 55px; display: none;"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></div><iframe class="post-likes-widget jetpack-likes-widget" name="like-post-frame-23669881-1216-52d28636d5656" height="55px" width="100%" frameborder="0" src="./A primer on OWIN cookie authentication middleware_files/saved_resource.htm" style="display: inline;"></iframe><span class="sd-text-color"></span><a class="sd-link-color"></a></div>
<div id="jp-relatedposts" class="jp-relatedposts" style="display: block;">
	<p class="jp-relatedposts-headline"><em>Related</em></p>
<p class="jp-relatedposts-post jp-relatedposts-post0" data-post-format="false"><strong><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?relatedposts_to=1261&relatedposts_order=0" title="A primer on external login providers (social logins) with OWIN/Katana authentication middleware

Like MVC 4, in MVC 5 and Visual Studio 2013 we have the ability to use external login providers (aka social logins) in our ASP.NET applications. The big change related to this from the prior version is that we no longer are using DotNetOpenAuth and instead are now using OWIN authentication middleware to handle the…" rel="nofollow">A primer on external login providers (social logins) with OWIN/Katana authentication middleware</a></strong><br><span>In "ASP.NET Security"</span></p><p class="jp-relatedposts-post jp-relatedposts-post1" data-post-format="false"><strong><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?relatedposts_to=1265&relatedposts_order=1" title="Host authentication and Web API with OWIN and active vs. passive authentication middleware

A quick note about Web API 2 security running in OWIN and a ASP.NET project (which you will see with the new templates in Visual Studio 2013). By default, Web API code running in a host will inherit the host&#39;s authentication model. This means if the web application uses cookie authentication or windows authentication for…" rel="nofollow">Host authentication and Web API with OWIN and active vs. passive authentication middleware</a></strong><br><span>In "ASP.NET Security"</span></p><p class="jp-relatedposts-post jp-relatedposts-post2" data-post-format="false"><strong><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?relatedposts_to=1263&relatedposts_order=2" title="Using cookie authentication middleware with Web API and 401 response codes

If you want to use cookie authentication middleware with a project that contains both ASP.NET code (WebForms or MVC) and Web API, then in the new Visual Studio 2013 you might notice some odd behavior when your Web API issues an unauthorized (401) HTTP response code. The assumption here is that the Web API code…" rel="nofollow">Using cookie authentication middleware with Web API and 401 response codes</a></strong><br><span>In "OWIN / Katana"</span></p></div></div>											</div><!--end entry-->
			<div class="post-footer">
				<div class="categories">from → <a href="http://brockallen.com/category/asp-net-security/" title="View all posts in ASP.NET Security" rel="category tag">ASP.NET Security</a>, <a href="http://brockallen.com/category/owin-katana/" title="View all posts in OWIN / Katana" rel="category tag">OWIN / Katana</a></div>
			</div><!--end post footer-->
		</div><!--end post-->
				<div class="navigation post single clear">
			<div class="alignleft"><a href="http://brockallen.com/2013/10/23/membershipreboot-in-identityserver/" rel="prev">← MembershipReboot in&nbsp;IdentityServer</a></div>
			<div class="alignright"><a href="http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/" rel="next">Host authentication and Web API with OWIN and active vs. passive authentication&nbsp;middleware →</a></div>
		</div><!--end pagination-->
		<!-- You can start editing here. -->
<div id="comments">
	<div class="comment-number">
		<span>16 Comments</span>
			<a id="leavecomment" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#respond" title="Leave One">leave one →</a>
		</div><!--end comment-number-->
			<ol class="commentlist">
			
			<li class="comment byuser comment-author-dominickbaier even thread-even depth-1 highlander-comment" id="comment-2466">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/75681814fbbb90c9224ea5ed0f8324ee" class="avatar avatar-60 grav-hashed grav-hijack" height="60" width="60" id="grav-75681814fbbb90c9224ea5ed0f8324ee-0"></div>
				<div class="c-body">
					<div class="c-head">
						<a href="http://dominickbaier.wordpress.com/" rel="external nofollow" class="url">Dominick Baier</a> <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-2466">permalink</a></span>					</div>
					<div class="c-date">
						October 25, 2013 1:11 am					</div>
										<p>Reblogged this on <a href="http://leastprivilege.com/2013/10/25/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/" rel="nofollow">http://www.leastprivilege.com</a>.</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=2466#respond" onclick="return addComment.moveForm(&quot;comment-2466&quot;, &quot;2466&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
</li><!-- #comment-## -->

			<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-2551">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/photo.jpg" class="avatar avatar-60" height="60" width="60"></div>
				<div class="c-body">
					<div class="c-head">
						<a href="https://plus.google.com/115380011614859470152" rel="external nofollow" class="url">Sam Dzirasa</a> <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-2551">permalink</a></span>					</div>
					<div class="c-date">
						November 5, 2013 4:40 pm					</div>
										<p>Thanks.  This article has helped me understand how the OWIN authentication works.  I have a question.  So if we get a claim from specifying scopes like “user_birthday” from  “facebook” where do we hook that into the claims?</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=2551#respond" onclick="return addComment.moveForm(&quot;comment-2551&quot;, &quot;2551&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
<ul class="children">

			<li class="comment byuser comment-author-brockallen bypostauthor even depth-2 highlander-comment" id="comment-2553">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/f17c1816a6f9bff29a515c75b950460a" class="avatar avatar-60 grav-hashed grav-hijack" height="60" width="60" id="grav-f17c1816a6f9bff29a515c75b950460a-0"></div>
				<div class="c-body">
					<div class="c-head">
						<a href="http://brockallen.com/" rel="external nofollow" class="url">brockallen</a> <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-2553">permalink</a></span><span class="asterisk">*</span>					</div>
					<div class="c-date">
						November 5, 2013 4:54 pm					</div>
										<p>I’ve not dug into it enough to give a great answer, but this post might help: <a href="http://forums.asp.net/t/1943654.aspx?Customizing+Google+Authentication" rel="nofollow">http://forums.asp.net/t/1943654.aspx?Customizing+Google+Authentication</a></p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=2553#respond" onclick="return addComment.moveForm(&quot;comment-2553&quot;, &quot;2553&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

			<li class="comment odd alt thread-even depth-1 highlander-comment" id="comment-2575">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/a94a80c172cf8319443d4fff51aecdf3" class="avatar avatar-60 grav-hashed grav-hijack" height="60" width="60" id="grav-a94a80c172cf8319443d4fff51aecdf3-0"></div>
				<div class="c-body">
					<div class="c-head">
						Venki <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-2575">permalink</a></span>					</div>
					<div class="c-date">
						November 7, 2013 9:35 am					</div>
										<p>Thank You Very Much .. This helped me a lot ..</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=2575#respond" onclick="return addComment.moveForm(&quot;comment-2575&quot;, &quot;2575&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
</li><!-- #comment-## -->

			<li class="comment even thread-odd thread-alt depth-1 highlander-comment" id="comment-2586">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/photo.jpg" class="avatar avatar-60" height="60" width="60"></div>
				<div class="c-body">
					<div class="c-head">
						<a href="https://plus.google.com/115380011614859470152" rel="external nofollow" class="url">Sam Dzirasa</a> <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-2586">permalink</a></span>					</div>
					<div class="c-date">
						November 8, 2013 10:25 am					</div>
										<p>Actually, this helped a lot.  I notice though that after the SignIn step.  The code immediately shows the user is Authenticated.  </p>
<p>However, after I then redirect another page; the the Authenticated flag becomes false — appears the entire context gets lost.</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=2586#respond" onclick="return addComment.moveForm(&quot;comment-2586&quot;, &quot;2586&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
</li><!-- #comment-## -->

			<li class="comment odd alt thread-even depth-1 highlander-comment" id="comment-2859">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/a392699995b84ff58cb31ea26e9bfe4a" class="avatar avatar-60 grav-hashed grav-hijack" height="60" width="60" id="grav-a392699995b84ff58cb31ea26e9bfe4a-0"></div>
				<div class="c-body">
					<div class="c-head">
						Dmitrij <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-2859">permalink</a></span>					</div>
					<div class="c-date">
						November 29, 2013 10:24 am					</div>
										<p>Hi Brock,<br>
I am using Google and Facebook authentication providers from the sample project from VS 2013 and have found a problem when I have successfully logged-in with Google or Facebook account and after that I choose log off, and try to log-in again with the same provider no Username and Password from another Google or Facebook account is asked.<br>
I am remaining in the same previous logged-in account.</p>
<p>Could you help how to show the google/facebook sign-in page every time when I select Google/Facebook login?</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=2859#respond" onclick="return addComment.moveForm(&quot;comment-2859&quot;, &quot;2859&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
<ul class="children">

			<li class="comment byuser comment-author-brockallen bypostauthor even depth-2 highlander-comment" id="comment-2929">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/f17c1816a6f9bff29a515c75b950460a" class="avatar avatar-60 grav-hashed grav-hijack" height="60" width="60" id="grav-f17c1816a6f9bff29a515c75b950460a-1"></div>
				<div class="c-body">
					<div class="c-head">
						<a href="http://brockallen.com/" rel="external nofollow" class="url">brockallen</a> <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-2929">permalink</a></span><span class="asterisk">*</span>					</div>
					<div class="c-date">
						December 7, 2013 3:32 pm					</div>
										<p>This is because those providers are using OAuth2 and that’s not an authentication protocol and as such there’s no concept of forcing re-authentication. Now, those providers might have customized their implementations to allow this sort of feature, but that’s provider specific. You’d have to go read their docs to see if they support it and then configure the middleware to pass the custom param.</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=2929#respond" onclick="return addComment.moveForm(&quot;comment-2929&quot;, &quot;2929&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

			<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-2908">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/37bf67b23de38c707d776e614231d6ff" class="avatar avatar-60 grav-hashed grav-hijack" height="60" width="60" id="grav-37bf67b23de38c707d776e614231d6ff-0"></div>
				<div class="c-body">
					<div class="c-head">
						Max <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-2908">permalink</a></span>					</div>
					<div class="c-date">
						December 5, 2013 7:25 pm					</div>
										<p>This was very helpful to implement cookie auth for the webapp version of a WebApi project, thank you so much!</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=2908#respond" onclick="return addComment.moveForm(&quot;comment-2908&quot;, &quot;2908&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
</li><!-- #comment-## -->

			<li class="comment even thread-even depth-1 highlander-comment" id="comment-3110">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/photo(1).jpg" class="avatar avatar-60" height="60" width="60"></div>
				<div class="c-body">
					<div class="c-head">
						<a href="https://plus.google.com/101226136690634623023" rel="external nofollow" class="url">Max Alexander</a> <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-3110">permalink</a></span>					</div>
					<div class="c-date">
						January 2, 2014 11:50 am					</div>
										<p>Is it possible to share the Owin Forms Authentication across different virtual directories/applications?</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=3110#respond" onclick="return addComment.moveForm(&quot;comment-3110&quot;, &quot;3110&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
<ul class="children">

			<li class="comment byuser comment-author-brockallen bypostauthor odd alt depth-2 highlander-comment" id="comment-3126">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/f17c1816a6f9bff29a515c75b950460a" class="avatar avatar-60 grav-hashed grav-hijack" height="60" width="60" id="grav-f17c1816a6f9bff29a515c75b950460a-2"></div>
				<div class="c-body">
					<div class="c-head">
						<a href="http://brockallen.com/" rel="external nofollow" class="url">brockallen</a> <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-3126">permalink</a></span><span class="asterisk">*</span>					</div>
					<div class="c-date">
						January 4, 2014 10:51 am					</div>
										<p>Sure, you just need to make sure you have the same verification logic and key. In OWIN this component is normally provided by the host, and in IIS this uses the machine key. In other hosts you’d need to configure it.</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=3126#respond" onclick="return addComment.moveForm(&quot;comment-3126&quot;, &quot;3126&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

			<li class="comment even thread-odd thread-alt depth-1 highlander-comment" id="comment-3146">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/1fbb13ace20a6e99b67a44e8600cfd56" class="avatar avatar-60 grav-hashed grav-hijack" height="60" width="60" id="grav-1fbb13ace20a6e99b67a44e8600cfd56-0"></div>
				<div class="c-body">
					<div class="c-head">
						G.bes <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-3146">permalink</a></span>					</div>
					<div class="c-date">
						January 6, 2014 2:28 pm					</div>
										<p>Great article! Thanks.</p>
<p>I’m wodering if there’s a way to  run a piece of code and signout the user automatically after a predefined timeout?</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=3146#respond" onclick="return addComment.moveForm(&quot;comment-3146&quot;, &quot;3146&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
<ul class="children">

			<li class="comment byuser comment-author-brockallen bypostauthor odd alt depth-2 highlander-comment" id="comment-3147">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/f17c1816a6f9bff29a515c75b950460a" class="avatar avatar-60 grav-hashed grav-hijack" height="60" width="60" id="grav-f17c1816a6f9bff29a515c75b950460a-3"></div>
				<div class="c-body">
					<div class="c-head">
						<a href="http://brockallen.com/" rel="external nofollow" class="url">brockallen</a> <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-3147">permalink</a></span><span class="asterisk">*</span>					</div>
					<div class="c-date">
						January 6, 2014 3:29 pm					</div>
										<p>From the server you can’t just reach out to the browser to revoke a cookie. So no, there’s nothing like this built in.</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=3147#respond" onclick="return addComment.moveForm(&quot;comment-3147&quot;, &quot;3147&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
<ul class="children">

			<li class="comment even depth-3 highlander-comment" id="comment-3151">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/1fbb13ace20a6e99b67a44e8600cfd56" class="avatar avatar-60 grav-hashed grav-hijack" height="60" width="60" id="grav-1fbb13ace20a6e99b67a44e8600cfd56-1"></div>
				<div class="c-body">
					<div class="c-head">
						G.bes <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-3151">permalink</a></span>					</div>
					<div class="c-date">
						January 7, 2014 1:49 am					</div>
										<p>Thanks for your reply. If i want to implement a home made  time-out mechanism wich starting point would you suggest? Which approch is suitable for this scenario?</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=3151#respond" onclick="return addComment.moveForm(&quot;comment-3151&quot;, &quot;3151&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
<ul class="children">

			<li class="comment byuser comment-author-brockallen bypostauthor odd alt depth-4 highlander-comment" id="comment-3163">
			<div class="c-grav"><img alt="" src="./A primer on OWIN cookie authentication middleware_files/f17c1816a6f9bff29a515c75b950460a" class="avatar avatar-60 grav-hashed grav-hijack" height="60" width="60" id="grav-f17c1816a6f9bff29a515c75b950460a-4"></div>
				<div class="c-body">
					<div class="c-head">
						<a href="http://brockallen.com/" rel="external nofollow" class="url">brockallen</a> <span class="c-permalink"><a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-3163">permalink</a></span><span class="asterisk">*</span>					</div>
					<div class="c-date">
						January 7, 2014 9:09 pm					</div>
										<p>Task.Delay</p>
										<div class="reply">
						<a class="comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/?replytocom=3163#respond" onclick="return addComment.moveForm(&quot;comment-3163&quot;, &quot;3163&quot;, &quot;respond&quot;, &quot;1216&quot;)">Reply</a>					</div>
									</div><!--end c-body-->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		</ol>
		<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
			<h3 class="pinghead">Trackbacks</h3>
		<ol class="pinglist">
				<li id="comment-2851"><a href="http://blog.decayingcode.com/post/Community-Update-November-28th-2013-Custom-OAuth-WebAPI-and-more" rel="external nofollow" class="url">Decaying Code | Community Update November 28th 2013 – Custom OAuth, WebAPI, and more</a></li><!-- #comment-## -->
	<li id="comment-3173"><a href="http://brockallen.com/2014/01/09/a-primer-on-external-login-providers-social-logins-with-owinkatana-authentication-middleware/" rel="external nofollow" class="url">A primer on external login providers (social logins) with OWIN/Katana authentication middleware | brockallen</a></li><!-- #comment-## -->
		</ol>
		</div><!--end comments-->

								<div id="respond" class="comment-respond js">
				<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="http://brockallen.com/wp-comments-post.php" method="post" id="commentform" class="comment-form">
																										


												<input type="hidden" id="highlander_comment_nonce" name="highlander_comment_nonce" value="a1df6a18e6"><input type="hidden" name="_wp_http_referer" value="/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/">
<input type="hidden" name="hc_post_as" id="hc_post_as" value="guest">

<div class="comment-form-field comment-textarea">
	
	<div id="comment-form-comment"><textarea title="Enter your comment here..." placeholder="Enter your comment here..." style="height: 36px; resize: none; overflow-y: hidden; position: absolute; top: 0px; left: -9999px; width: 578px; line-height: normal; text-decoration: none; letter-spacing: 0px;" tabindex="-1" aria-hidden="true"></textarea><textarea id="comment" name="comment" title="Enter your comment here..." placeholder="Enter your comment here..." style="height: 36px; resize: none; overflow-y: hidden;"></textarea></div>
</div>

<div id="comment-form-identity" style="display: none;">

	<div id="comment-form-nascar">
		<p>Fill in your details below or click an icon to log in:</p>
		<ul>
			<li class="selected" style="display:none;">
				<a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-form-guest" id="postas-guest" title="Guest">
					<span></span>
				</a>
			</li>
			<li>
				<a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-form-load-service:WordPress.com" id="postas-wordpress" title="WordPress.com">
					<span></span>
				</a>
			</li>
			<li>
				<a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-form-load-service:Twitter" id="postas-twitter" title="Twitter">
					<span></span>
				</a>
			</li>
			<li>
				<a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#comment-form-load-service:Facebook" id="postas-facebook" title="Facebook">
					<span></span>
				</a>
			</li>
			<li>
			<iframe id="googleplus-sign-in" name="googleplus-sign-in" src="./A primer on OWIN cookie authentication middleware_files/saved_resource(7).htm" width="24" height="24" scrolling="no" allowtransparency="true" seamless="seamless" frameborder="0"></iframe>
			</li>
		</ul>
	</div>

	<div id="comment-form-guest" class="comment-form-service selected">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
<a href="https://gravatar.com/site/signup/" target="_blank">				<img src="./A primer on OWIN cookie authentication middleware_files/ad516503a11cd5ca435acc9bb6523536" alt="Gravatar" width="25" class="no-grav">
</a>			</div>

				<div class="comment-form-fields">
				<div class="comment-form-field comment-form-email">
					<label for="email">Email <span class="required">(required)</span> <span class="nopublish">(Address never made public)</span></label>
					<div class="comment-form-input"><input id="email" name="email" type="email" value=""></div>
				</div>
				<div class="comment-form-field comment-form-author">
					<label for="author">Name <span class="required">(required)</span></label>
					<div class="comment-form-input"><input id="author" name="author" type="text" value=""></div>
				</div>
				<div class="comment-form-field comment-form-url">
					<label for="url">Website</label>
					<div class="comment-form-input"><input id="url" name="url" type="text" value=""></div>
				</div>
			</div>
	
		</div>
	</div>

	<div id="comment-form-wordpress" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="./A primer on OWIN cookie authentication middleware_files/wplogo.png" alt="WordPress.com Logo" width="25" class="no-grav">
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="wp_avatar" id="wordpress-avatar" class="comment-meta-wordpress" value="">
				<input type="hidden" name="wp_user_id" id="wordpress-user_id" class="comment-meta-wordpress" value="">
				<input type="hidden" name="wp_access_token" id="wordpress-access_token" class="comment-meta-wordpress" value="">
				<p class="comment-form-posting-as pa-wordpress"><strong></strong> You are commenting using your WordPress.com account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'wordpress' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-twitter" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="./A primer on OWIN cookie authentication middleware_files/ad516503a11cd5ca435acc9bb6523536" alt="Twitter picture" width="25" class="no-grav">
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="twitter_avatar" id="twitter-avatar" class="comment-meta-twitter" value="">
				<input type="hidden" name="twitter_user_id" id="twitter-user_id" class="comment-meta-twitter" value="">
				<input type="hidden" name="twitter_access_token" id="twitter-access_token" class="comment-meta-twitter" value="">
				<p class="comment-form-posting-as pa-twitter"><strong></strong> You are commenting using your Twitter account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'twitter' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-facebook" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="./A primer on OWIN cookie authentication middleware_files/ad516503a11cd5ca435acc9bb6523536" alt="Facebook photo" width="25" class="no-grav">
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="fb_avatar" id="facebook-avatar" class="comment-meta-facebook" value="">
				<input type="hidden" name="fb_user_id" id="facebook-user_id" class="comment-meta-facebook" value="">
				<input type="hidden" name="fb_access_token" id="facebook-access_token" class="comment-meta-facebook" value="">
				<p class="comment-form-posting-as pa-facebook"><strong></strong> You are commenting using your Facebook account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'facebook' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-googleplus" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="./A primer on OWIN cookie authentication middleware_files/ad516503a11cd5ca435acc9bb6523536" alt="Google+ photo" width="25" class="no-grav">
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="googleplus_avatar" id="googleplus-avatar" class="comment-meta-googleplus" value="">
				<input type="hidden" name="googleplus_user_id" id="googleplus-user_id" class="comment-meta-googleplus" value="">
				<input type="hidden" name="googleplus_access_token" id="googleplus-access_token" class="comment-meta-googleplus" value="">
				<p class="comment-form-posting-as pa-googleplus"><strong></strong> You are commenting using your Google+ account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'googleplus' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="http://brockallen.com/2013/10/24/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer/#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>


	<div id="comment-form-load-service" class="comment-form-service">
		<div class="comment-form-posting-as-cancel"><a href="javascript:HighlanderComments.cancelExternalWindow();">Cancel</a></div>
		<p>Connecting to %s</p>
	</div>

	
</div>

<script type="text/javascript">
var highlander_expando_javascript = function(){
	var input = document.createElement( 'input' ),
	    comment = jQuery( '#comment' );

	if ( 'placeholder' in input ) {
		comment.attr( 'placeholder', jQuery( '.comment-textarea label' ).remove().text() );
	}

	// Expando Mode: start small, then auto-resize on first click + text length
	jQuery( '#comment-form-identity' ).hide();
	jQuery( '#comment-form-subscribe' ).hide();
	jQuery( '#commentform .form-submit' ).hide();

	comment.css( { 'height':'10px' } ).one( 'focus', function() {
		var timer = setInterval( HighlanderComments.resizeCallback, 10 )
		jQuery( this ).animate( { 'height': HighlanderComments.initialHeight } ).delay( 100 ).queue( function(n) { clearInterval( timer ); HighlanderComments.resizeCallback(); n(); } );
		jQuery( '#comment-form-identity' ).slideDown();
		jQuery( '#comment-form-subscribe' ).slideDown();
		jQuery( '#commentform .form-submit' ).slideDown();
	});
}
jQuery(document).ready( highlander_expando_javascript );
</script>

<div id="comment-form-subscribe" style="display: none;">
	<p class="comment-subscription-form"><input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;" tabindex="6"> <label class="subscribe-label" id="subscribe-label" for="subscribe" style="display: inline;">Notify me of follow-up comments via email.</label></p><p class="post-subscription-form"><input type="checkbox" name="subscribe_blog" id="subscribe_blog" value="subscribe" style="width: auto;" tabindex="7"> <label class="subscribe-label" id="subscribe-blog-label" for="subscribe_blog" style="display: inline;">Notify me of new posts via email.</label></p></div>

												<p class="form-submit" style="display: none;">
							<input name="submit" type="submit" id="comment-submit" value="Post Comment">
							<input type="hidden" name="comment_post_ID" value="1216" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
						</p>
						
<input type="hidden" name="genseq" value="1389528630">
<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="c72a22a08f"></p><script type="text/javascript" src="./A primer on OWIN cookie authentication middleware_files/form.js"></script>
<p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="1389550226045"></p>					</form>
							</div><!-- #respond -->
			<div style="clear: both"></div>			</div><!--end content-->
	<div id="sidebar">
				<ul>			<li id="categories-3" class="widget widget_categories"><h2 class="widgettitle">Categories</h2>		<ul>
	<li class="cat-item cat-item-94234"><a href="http://brockallen.com/category/asp-net/" title="View all posts filed under ASP.NET">ASP.NET</a> (11)
</li>
	<li class="cat-item cat-item-20631750"><a href="http://brockallen.com/category/asp-net-security/" title="View all posts filed under ASP.NET Security">ASP.NET Security</a> (19)
</li>
	<li class="cat-item cat-item-2363040"><a href="http://brockallen.com/category/cors/" title="View all posts filed under CORS">CORS</a> (5)
</li>
	<li class="cat-item cat-item-147131459"><a href="http://brockallen.com/category/developmentor-learningline/" title="View all posts filed under DevelopMentor / LearningLine">DevelopMentor / LearningLine</a> (1)
</li>
	<li class="cat-item cat-item-47338723"><a href="http://brockallen.com/category/identitymodel/" title="View all posts filed under IdentityModel">IdentityModel</a> (18)
</li>
	<li class="cat-item cat-item-91500362"><a href="http://brockallen.com/category/identityserver/" title="View all posts filed under IdentityServer">IdentityServer</a> (9)
</li>
	<li class="cat-item cat-item-188732566"><a href="http://brockallen.com/category/membershipreboot/" title="View all posts filed under MembershipReboot">MembershipReboot</a> (8)
</li>
	<li class="cat-item cat-item-35529257"><a href="http://brockallen.com/category/oauth2/" title="View all posts filed under OAuth2">OAuth2</a> (5)
</li>
	<li class="cat-item cat-item-191507473"><a href="http://brockallen.com/category/owin-katana/" title="View all posts filed under OWIN / Katana">OWIN / Katana</a> (5)
</li>
	<li class="cat-item cat-item-92424185"><a href="http://brockallen.com/category/rest-webapi/" title="View all posts filed under REST / WebAPI">REST / WebAPI</a> (9)
</li>
	<li class="cat-item cat-item-39484"><a href="http://brockallen.com/category/speaking/" title="View all posts filed under Speaking">Speaking</a> (20)
</li>
	<li class="cat-item cat-item-143169810"><a href="http://brockallen.com/category/wif-claims/" title="View all posts filed under WIF / Claims">WIF / Claims</a> (23)
</li>
		</ul>
</li><li id="rss_links-3" class="widget widget_rss_links"><h2 class="widgettitle">Feeds</h2><p class="size-small"><a class="feed-image-link" href="http://brockallen.com/feed/" title="Subscribe to Posts"><img src="./A primer on OWIN cookie authentication middleware_files/orange-small.png" alt="RSS Feed"></a>&nbsp;<a href="http://brockallen.com/feed/" title="Subscribe to Posts">RSS - Posts</a></p><p class="size-small"><a class="feed-image-link" href="http://brockallen.com/comments/feed/" title="Subscribe to Comments"><img src="./A primer on OWIN cookie authentication middleware_files/orange-small.png" alt="RSS Feed"></a>&nbsp;<a href="http://brockallen.com/comments/feed/" title="Subscribe to Comments">RSS - Comments</a></p>
</li><li id="archives-3" class="widget widget_archive"><h2 class="widgettitle">Archives</h2>		<ul>
			<li><a href="http://brockallen.com/2014/01/">January 2014</a>&nbsp;(1)</li>
	<li><a href="http://brockallen.com/2013/12/">December 2013</a>&nbsp;(4)</li>
	<li><a href="http://brockallen.com/2013/11/">November 2013</a>&nbsp;(1)</li>
	<li><a href="http://brockallen.com/2013/10/">October 2013</a>&nbsp;(9)</li>
	<li><a href="http://brockallen.com/2013/09/">September 2013</a>&nbsp;(1)</li>
	<li><a href="http://brockallen.com/2013/08/">August 2013</a>&nbsp;(5)</li>
	<li><a href="http://brockallen.com/2013/07/">July 2013</a>&nbsp;(6)</li>
	<li><a href="http://brockallen.com/2013/06/">June 2013</a>&nbsp;(1)</li>
	<li><a href="http://brockallen.com/2013/05/">May 2013</a>&nbsp;(4)</li>
	<li><a href="http://brockallen.com/2013/04/">April 2013</a>&nbsp;(1)</li>
	<li><a href="http://brockallen.com/2013/03/">March 2013</a>&nbsp;(3)</li>
	<li><a href="http://brockallen.com/2013/02/">February 2013</a>&nbsp;(15)</li>
	<li><a href="http://brockallen.com/2013/01/">January 2013</a>&nbsp;(4)</li>
	<li><a href="http://brockallen.com/2012/12/">December 2012</a>&nbsp;(1)</li>
	<li><a href="http://brockallen.com/2012/11/">November 2012</a>&nbsp;(1)</li>
	<li><a href="http://brockallen.com/2012/10/">October 2012</a>&nbsp;(7)</li>
	<li><a href="http://brockallen.com/2012/09/">September 2012</a>&nbsp;(5)</li>
	<li><a href="http://brockallen.com/2012/08/">August 2012</a>&nbsp;(1)</li>
	<li><a href="http://brockallen.com/2012/07/">July 2012</a>&nbsp;(3)</li>
	<li><a href="http://brockallen.com/2012/06/">June 2012</a>&nbsp;(7)</li>
	<li><a href="http://brockallen.com/2012/05/">May 2012</a>&nbsp;(8)</li>
	<li><a href="http://brockallen.com/2012/04/">April 2012</a>&nbsp;(5)</li>
	<li><a href="http://brockallen.com/2012/03/">March 2012</a>&nbsp;(3)</li>
	<li><a href="http://brockallen.com/2012/02/">February 2012</a>&nbsp;(1)</li>
	<li><a href="http://brockallen.com/2011/10/">October 2011</a>&nbsp;(1)</li>
	<li><a href="http://brockallen.com/2011/06/">June 2011</a>&nbsp;(1)</li>
		</ul>
</li>		</ul>															</div><!--end sidebar-->	<div id="footer">
		<div class="footer-liner">
			<p class="right"><a href="http://wordpress.com/?ref=footer" rel="generator">Blog at WordPress.com</a>.</p>
			<p><a href="http://theme.wordpress.com/credits/brockallen.com/" title="Learn about customizing this theme with the Custom Design upgrade">Customized Vigilance Theme</a>. </p>
		</div><!-- .footer-liner -->
	</div><!--end footer-->
</div><!--end wrapper-->

<script type="text/javascript">
var _qevents = _qevents || [], wpcomQuantcastData = {"qacct":"p-18-mFEk4J448M","labels":"language.en,type.wpcom"};
function wpcomQuantcastPixel( labels, options ) {
	var i, defaults = wpcomQuantcastData, data = { event: 'ajax' };

	labels  = labels  || '';
	options = options || {};

	if ( typeof labels != 'string' )
		options = labels;

	for ( i in defaults ) {
		data[i] = defaults[i];
	}

	for ( i in options ) {
		data[i] = options[i];
	}

	if ( data.labels ) {
		data.labels += ',' + labels;
	} else {
		data.labels = labels;
	}

	_qevents.push( data );
};
(function() {var elem = document.createElement('script');elem.src = (document.location.protocol == "https:" ? "https://secure" : "http://edge") + ".quantserve.com/quant.js";elem.async = true;elem.type = "text/javascript";var scpt = document.getElementsByTagName('script')[0];scpt.parentNode.insertBefore(elem, scpt);  })();
_qevents.push( wpcomQuantcastData );
</script>
<noscript>&lt;div style="display: none;"&gt;&lt;img src="//pixel.quantserve.com/pixel/p-18-mFEk4J448M.gif?labels=language.en%2Ctype.wpcom" height="1" width="1" alt="" /&gt;&lt;/div&gt;</noscript>

<script type="text/javascript" src="./A primer on OWIN cookie authentication middleware_files/gprofiles.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type="text/javascript" src="./A primer on OWIN cookie authentication middleware_files/wpgroho.js"></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {
			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-75681814fbbb90c9224ea5ed0f8324ee">
	</div>
	<div class="grofile-hash-map-fed955871dae22b2e8b49b2f76feaf07">
	</div>
	<div class="grofile-hash-map-f17c1816a6f9bff29a515c75b950460a">
	</div>
	<div class="grofile-hash-map-a94a80c172cf8319443d4fff51aecdf3">
	</div>
	<div class="grofile-hash-map-a392699995b84ff58cb31ea26e9bfe4a">
	</div>
	<div class="grofile-hash-map-37bf67b23de38c707d776e614231d6ff">
	</div>
	<div class="grofile-hash-map-d2b6e15a2f91f1a5e42668374e725624">
	</div>
	<div class="grofile-hash-map-1fbb13ace20a6e99b67a44e8600cfd56">
	</div>
	</div>
<script type="text/javascript">
/* <![CDATA[ */
var HighlanderComments = {"loggingInText":"Logging In\u2026","submittingText":"Posting Comment\u2026","postCommentText":"Post Comment","connectingToText":"Connecting to %s","commentingAsText":"%1$s: You are commenting using your %2$s account.","logoutText":"Log Out","loginText":"Log In","connectURL":"http:\/\/brockallen.wordpress.com\/public.api\/connect\/?action=request","logoutURL":"http:\/\/brockallen.wordpress.com\/wp-login.php?action=logout&_wpnonce=a269a760bc","homeURL":"http:\/\/brockallen.com\/","postID":"1216","gravDefault":"identicon","enterACommentError":"Please enter a comment","enterEmailError":"Please enter your email address here","invalidEmailError":"Invalid email address","enterAuthorError":"Please enter your name here","gravatarFromEmail":"This picture will show whenever you leave a comment. Click to customize it.","logInToExternalAccount":"Log in to use details from one of these accounts.","change":"Change","changeAccount":"Change Account","comment_registration":"","userIsLoggedIn":"","isJetpack":"0"};
/* ]]> */
</script>
<script type="text/javascript" src="./A primer on OWIN cookie authentication middleware_files/saved_resource(3)"></script>

	<script type="text/javascript">
		WPCOM_sharing_counts = {"http:\/\/brockallen.com\/2013\/10\/24\/a-primer-on-owin-cookie-authentication-middleware-for-the-asp-net-developer\/":1216}	</script>
		<script type="text/javascript">
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-twitter' ).on( 'click', function() {
				window.open( jQuery(this).attr( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
				return false;
			});
		});
		</script>
				<script type="text/javascript">
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-facebook' ).on( 'click', function() {
				window.open( jQuery(this).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
		});
		</script>
				<script type="text/javascript">
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-google-plus-1' ).on( 'click', function() {
				window.open( jQuery(this).attr( 'href' ), 'wpcomgoogle-plus-1', 'menubar=1,resizable=1,width=480,height=550' );
				return false;
			});
		});
		</script>
				<iframe src="./A primer on OWIN cookie authentication middleware_files/master.htm" scrolling="no" id="likes-master" name="likes-master" style="display:none;"></iframe>
		<div id="likes-other-gravatars"><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
		<script type="text/javascript">
		//<![CDATA[
			var jetpackLikesWidgetQueue = [];
			var jetpackLikesWidgetBatch = [];
			var jetpackLikesMasterReady = false;

			function JetpackLikespostMessage( message, target ) {
				if ( "string" === typeof message ){
					try{
						message = JSON.parse( message );
					}
					catch(e) {
						return;
					}
				}

				pm( {
					target: target,
					type: 'likesMessage',
					data: message,
					origin: '*'
				} );
			}

			function JetpackLikesBatchHandler() {
				var requests = [];
				jQuery( 'div.jetpack-likes-widget-unloaded' ).each( function( i ) {
					if ( jetpackLikesWidgetBatch.indexOf( this.id ) > -1 )
						return;
					jetpackLikesWidgetBatch.push( this.id );
					var regex = /like-(post|comment)-wrapper-(\d+)-(\d+)-(\w+)/;
					var match = regex.exec( this.id );
					if ( ! match || match.length != 5 )
						return;

					var info = {
						blog_id: match[2],
						width:   this.width
					};

					if ( 'post' == match[1] ) {
						info.post_id = match[3];
					} else if ( 'comment' == match[1] ) {
						info.comment_id = match[3];
					}

					info.obj_id = match[4];

					requests.push( info );
				});

				if ( requests.length > 0 ) {
					JetpackLikespostMessage( { event: 'initialBatch', requests: requests }, window.frames['likes-master'] );
				}
			}

			function JetpackLikesMessageListener( event ) {
				if ( "undefined" == typeof event.event )
					return;

				if ( 'masterReady' == event.event ) {
					jQuery( document ).ready( function() {
						jetpackLikesMasterReady = true;

						var stylesData = {
								event: 'injectStyles'
						};

						if ( jQuery( 'iframe.admin-bar-likes-widget' ).length > 0 ) {
							JetpackLikespostMessage( { event: 'adminBarEnabled' }, window.frames[ 'likes-master' ] );

							stylesData.adminBarStyles = {
								background: jQuery( '#wpadminbar .quicklinks li#wp-admin-bar-wpl-like > a' ).css( 'background' ),
								isRtl: ( 'rtl' == jQuery( '#wpadminbar' ).css( 'direction' ) )
							};
						}

						if ( !window.addEventListener )
							jQuery( '#wp-admin-bar-admin-bar-likes-widget' ).hide();

						stylesData.textStyles = {
							color: jQuery( '.sd-text-color').css( 'color' ),
							fontFamily: jQuery( '.sd-text-color' ).css( 'font-family' ),
							fontSize: jQuery( '.sd-text-color' ).css( 'font-size' ),
							direction: jQuery( '.sd-text-color' ).css( 'direction' ),
							fontWeight: jQuery( '.sd-text-color' ).css( 'font-weight' ),
							fontStyle: jQuery( '.sd-text-color' ).css( 'font-style' ),
							textDecoration: jQuery( '.sd-text-color' ).css('text-decoration')
						};

						stylesData.linkStyles = {
							color: jQuery( '.sd-link-color' ).css('color'),
							fontFamily: jQuery( '.sd-link-color' ).css('font-family'),
							fontSize: jQuery( '.sd-link-color' ).css('font-size'),
							textDecoration: jQuery( '.sd-link-color' ).css('text-decoration'),
							fontWeight: jQuery( '.sd-link-color' ).css( 'font-weight' ),
							fontStyle: jQuery( '.sd-link-color' ).css( 'font-style' )
						};

						JetpackLikespostMessage( stylesData, window.frames[ 'likes-master' ] );

						JetpackLikesBatchHandler();

						jQuery( document ).on( 'inview', 'div.jetpack-likes-widget-unloaded', function() {
							jetpackLikesWidgetQueue.push( this.id );
						});
					});
				}

				if ( 'showLikeWidget' == event.event ) {
					jQuery( '#' + event.id + ' .post-likes-widget-placeholder'  ).fadeOut( 'fast', function() {
						jQuery( '#' + event.id + ' .post-likes-widget' ).fadeIn( 'fast', function() {
							JetpackLikespostMessage( { event: 'likeWidgetDisplayed', blog_id: event.blog_id, post_id: event.post_id, obj_id: event.obj_id }, window.frames['likes-master'] );
						});
					});
				}

				if ( 'showOtherGravatars' == event.event ) {
					var $container = jQuery( '#likes-other-gravatars' );
					var $list = $container.find( 'ul' );

					$container.hide();
					$list.html( '' );

					$container.find( '.likes-text span' ).text( event.total );

					jQuery.each( event.likers, function( i, liker ) {
						$list.append( '<li class="' + liker.css_class + '"><a href="' + liker.profile_URL + '" class="wpl-liker" rel="nofollow" target="_parent"><img src="' + liker.avatar_URL + '" alt="' + liker.name + '" width="30" height="30" style="padding-right: 3px;" /></a></li>');
					} );

					var offset = jQuery( "[name='" + event.parent + "']" ).offset();

					$container.css( 'left', offset.left + event.position.left - 10 + 'px' );
					$container.css( 'top', offset.top + event.position.top - 33 + 'px' );

					var rowLength = Math.floor( event.width / 37 );
					var height = ( Math.ceil( event.likers.length / rowLength ) * 37 ) + 13;
					if ( height > 204 ) {
						height = 204;
					}

					$container.css( 'height', height + 'px' );
					$container.css( 'width', rowLength * 37 - 7 + 'px' );

					$list.css( 'width', rowLength * 37 + 'px' );

					$container.fadeIn( 'slow' );

					var scrollbarWidth = $list[0].offsetWidth - $list[0].clientWidth;
					if ( scrollbarWidth > 0 ) {
						$container.width( $container.width() + scrollbarWidth );
						$list.width( $list.width() + scrollbarWidth );
					}
				}
			}

			pm.bind( 'likesMessage', function(e) { JetpackLikesMessageListener(e); } );

			jQuery( document ).click( function( e ) {
				var $container = jQuery( '#likes-other-gravatars' );

				if ( $container.has( e.target ).length === 0 ) {
					$container.fadeOut( 'slow' );
				}
			});

			function JetpackLikesWidgetQueueHandler() {
				var wrapperID;
				if ( ! jetpackLikesMasterReady ) {
					setTimeout( JetpackLikesWidgetQueueHandler, 500 );
					return;
				}

				if ( jetpackLikesWidgetQueue.length > 0 ) {
					// We may have a widget that needs creating now
					var found = false;
					while( jetpackLikesWidgetQueue.length > 0 ) {
						// Grab the first member of the queue that isn't already loading.
						wrapperID = jetpackLikesWidgetQueue.splice( 0, 1 )[0];
						if ( jQuery( '#' + wrapperID ).hasClass( 'jetpack-likes-widget-unloaded' ) ) {
							found = true;
							break;
						}
					}
					if ( ! found ) {
						setTimeout( JetpackLikesWidgetQueueHandler, 500 );
						return;
					}
				} else if ( jQuery( 'div.jetpack-likes-widget-unloaded' ).length > 0 ) {
					// Grab any unloaded widgets for a batch request
					JetpackLikesBatchHandler();

					// Get the next unloaded widget
					wrapperID = jQuery( 'div.jetpack-likes-widget-unloaded' ).first()[0].id;
					if ( ! wrapperID ) {
						// Everything is currently loaded
						setTimeout( JetpackLikesWidgetQueueHandler, 500 );
						return;
					}
				}

				if ( 'undefined' === typeof wrapperID ) {
					setTimeout( JetpackLikesWidgetQueueHandler, 500 );
					return;
				}

				var $wrapper = jQuery( '#' + wrapperID );
				$wrapper.find( 'iframe' ).remove();

				if ( $wrapper.hasClass( 'slim-likes-widget' ) ) {
					$wrapper.find( '.post-likes-widget-placeholder' ).after( "<iframe class='post-likes-widget jetpack-likes-widget' name='" + $wrapper.data( 'name' ) + "' height='22px' width='68px' frameBorder='0' scrolling='no' src='" + $wrapper.data( 'src' ) + "'></iframe>" );
				} else {
					$wrapper.find( '.post-likes-widget-placeholder' ).after( "<iframe class='post-likes-widget jetpack-likes-widget' name='" + $wrapper.data( 'name' ) + "' height='55px' width='100%' frameBorder='0' src='" + $wrapper.data( 'src' ) + "'></iframe>" );
				}

				$wrapper.removeClass( 'jetpack-likes-widget-unloaded' ).addClass( 'jetpack-likes-widget-loading' );

				$wrapper.find( 'iframe' ).load( function( e ) {
					var $iframe = jQuery( e.target );
					$wrapper.removeClass( 'jetpack-likes-widget-loading' ).addClass( 'jetpack-likes-widget-loaded' );

					JetpackLikespostMessage( { event: 'loadLikeWidget', name: $iframe.attr( 'name' ), width: $iframe.width() }, window.frames[ 'likes-master' ] );

					if ( $wrapper.hasClass( 'slim-likes-widget' ) ) {
						$wrapper.find( 'iframe' ).Jetpack( 'resizeable' );
					}
				});
				setTimeout( JetpackLikesWidgetQueueHandler, 250 );
			}
			JetpackLikesWidgetQueueHandler();
		//]]>
		</script>
<script type="text/javascript" src="./A primer on OWIN cookie authentication middleware_files/saved_resource(4)"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://s0.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?m=1370811927g&amp;ver=3.0.83c";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://s0.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?m=1363304414g&amp;ver=3.0.83c";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript">
/* <![CDATA[ */
var recaptcha_options = {"lang":"en"};
/* ]]> */
</script>
<script type="text/javascript" src="./A primer on OWIN cookie authentication middleware_files/saved_resource(5)"></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="./A primer on OWIN cookie authentication middleware_files/w.js" type="text/javascript"></script>
<script type="text/javascript">
st_go({'blog':'23669881','v':'wpcom','tz':'-5','user_id':'0','post':'1216','subd':'brockallen'});
ex_go({'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGRVYVNrSFguN3FwSmQ5RGtNX3VQcj1yVzhiflM1THQtLGFdQ2toOXYlNCVaeklqTUlaNm1kY3ZwbnZlLFpPP0pBc2JPRkMsdE4zS1B0Jkp8LjdLeVhJSHQlWFE2LWkzY1VHRWhScD1vOE9fbURGZlRSTiZvbGd1RWQ5PUNHT2k2OE9FdURXanNmMn4tUXQ0LlE2Q1kmRzRBb0Z8bllzaUZNLG1PJlt4dVN+WFJCTGxBW2UlSUxHWUF6dDRVeFV4ckNFfj1aVi5VU0RtLlVHW1F1QkMmZ1hCJWUuY0wmJl1iXXEweTVwZGpNRS40UXVscnNZWSxlXXFXP0xpdUUscXM='});
addLoadEvent(function(){linktracker_init('23669881',1216);});
	</script><img id="wpstats" src="./A primer on OWIN cookie authentication middleware_files/g.gif" alt=""><img id="wpstats2" src="./A primer on OWIN cookie authentication middleware_files/g(1).gif" alt="" style="display:none">
<noscript>&lt;img src="http://stats.wordpress.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /&gt;</noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//stats.wordpress.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script>
</body></html>